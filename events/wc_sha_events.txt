namespace = WCSHA

### Sha mechanics ###
### Sha - trigger:
# Sha of Anger - wroth
# Sha of Despair - depressed
# Sha of Doubt - paranoid
# Sha of Fear - craven
# Sha of Hatred - zealous
# Sha of Pride - proud
# Sha of Violence - cruel

### Sha tombola
character_event = {
	id = WCSHA.100
	
	is_triggered_only = yes
	hide_window = yes
	
	only_playable = yes
	
	trigger = {
		is_alive = yes
		is_dying = no
		
		is_playable = yes
		is_adult = yes
		
		NOT = { has_character_flag = sha_immunity_flag }
		is_infested_by_sha_trigger = no

		OR = {
			trait = wroth
			trait = depressed
			trait = paranoid
			trait = craven
			trait = zealous
			trait = proud
			trait = cruel
		}
		
		is_susceptible_to_void_corruption_trigger = yes
		capital_scope = { region = world_pandaria }
	}
	
	weight_multiplier = {
		days = 1
		# Negative emotions
		modifier = {
			factor = 1.5
			trait = wroth
		}
		modifier = {
			factor = 1.5
			trait = depressed
		}
		modifier = {
			factor = 1.5
			trait = paranoid
		}
		modifier = {
			factor = 1.5
			trait = craven
		}
		modifier = {
			factor = 1.5
			trait = zealous
		}
		modifier = {
			factor = 1.5
			trait = proud
		}
		modifier = {
			factor = 1.5
			trait = cruel
		}
		
		# Less chances, but possible
		modifier = {
			factor = 0.5
			true_religion = old_gods_worship
		}
	}
	
	immediate = {
		change_variable = { which = global_rulers_infested_by_sha value = 1 }
		
		set_character_flag = sha_immunity_flag	# Only once in life
		
		random_list = {
			10 = {
				trigger = { trait = wroth }
				set_character_flag = flag_infested_by_sha_of_anger
			}
			10 = {
				trigger = { trait = depressed }
				set_character_flag = flag_infested_by_sha_of_despair
			}
			10 = {
				trigger = { trait = paranoid }
				set_character_flag = flag_infested_by_sha_of_doubt
			}
			10 = {
				trigger = { trait = craven }
				set_character_flag = flag_infested_by_sha_of_fear
			}
			10 = {
				trigger = { trait = zealous }
				set_character_flag = flag_infested_by_sha_of_hatred
			}
			10 = {
				trigger = { trait = proud }
				set_character_flag = flag_infested_by_sha_of_pride
			}
			10 = {
				trigger = { trait = cruel }
				set_character_flag = flag_infested_by_sha_of_violence
			}
			fallback = {
				set_character_flag = flag_infested_by_sha_of_fear
			}
		}
		
		character_event = { id = WCSHA.110 }
	}
}
### Sha infests character
character_event = {
	id = WCSHA.110
	desc = EVTDESC_WCSHA_110
	picture = GFX_evt_yshaarj
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = {
			trigger = { has_character_flag = flag_infested_by_sha_of_anger }
			text = ANGER_OPTION
		}
		name = {
			trigger = { has_character_flag = flag_infested_by_sha_of_despair }
			text = DESPAIR_OPTION
		}
		name = {
			trigger = { has_character_flag = flag_infested_by_sha_of_doubt }
			text = DOUBT_OPTION
		}
		name = {
			trigger = { has_character_flag = flag_infested_by_sha_of_fear }
			text = FEAR_OPTION
		}
		name = {
			trigger = { has_character_flag = flag_infested_by_sha_of_hatred }
			text = HATRED_OPTION
		}
		name = {
			trigger = { has_character_flag = flag_infested_by_sha_of_pride }
			text = PRIDE_OPTION
		}
		name = {
			trigger = { has_character_flag = flag_infested_by_sha_of_violence }
			text = VIOLENCE_OPTION
		}
		
		trigger_switch = {
			on_trigger = has_character_flag
			flag_infested_by_sha_of_anger = { add_character_modifier = { name = infested_by_sha_of_anger years = 11 } }
			flag_infested_by_sha_of_despair = { add_character_modifier = { name = infested_by_sha_of_despair years = 11 } }
			flag_infested_by_sha_of_doubt = { add_character_modifier = { name = infested_by_sha_of_doubt years = 11 } }
			flag_infested_by_sha_of_fear = { add_character_modifier = { name = infested_by_sha_of_fear years = 11 } }
			flag_infested_by_sha_of_hatred = { add_character_modifier = { name = infested_by_sha_of_hatred years = 11 } }
			flag_infested_by_sha_of_pride = { add_character_modifier = { name = infested_by_sha_of_pride years = 11 } }
			flag_infested_by_sha_of_violence = { add_character_modifier = { name = infested_by_sha_of_violence years = 11 } }
		}
		add_35_void_corruption_effect = yes
		
		clear_flags_with_prefix = flag_infested_by_sha_of_
		
		character_event = { id = WCSHA.120 years = 5 random = 1825 }
	}
}
### Sha retreats
character_event = {
	id = WCSHA.120
	desc = EVTDESC_WCSHA_120
	picture = GFX_evt_yshaarj
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_WCSHA_120
		
		trigger_switch = {
			on_trigger = has_character_modifier
			infested_by_sha_of_anger = {
				remove_character_modifier = infested_by_sha_of_anger
				remove_trait_silently_wroth_effect = yes
			}
			infested_by_sha_of_despair = {
				remove_character_modifier = infested_by_sha_of_despair
				remove_trait_silently_depressed_effect = yes
			}
			infested_by_sha_of_doubt = {
				remove_character_modifier = infested_by_sha_of_doubt
				remove_trait_silently_paranoid_effect = yes
			}
			infested_by_sha_of_fear = {
				remove_character_modifier = infested_by_sha_of_fear
				remove_trait_silently_craven_effect = yes
			}
			infested_by_sha_of_hatred = {
				remove_character_modifier = infested_by_sha_of_hatred
				remove_trait_silently_zealous_effect = yes
			}
			infested_by_sha_of_pride = {
				remove_character_modifier = infested_by_sha_of_pride
				remove_trait_silently_proud_effect = yes
			}
			infested_by_sha_of_violence = {
				remove_character_modifier = infested_by_sha_of_violence
				remove_trait_silently_cruel_effect = yes
			}
		}
	}
}